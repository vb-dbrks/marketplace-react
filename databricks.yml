# Databricks Asset Bundle Configuration for Astellas Data Marketplace
# This bundle defines the complete application including the web app and database resources

bundle:
  name: astellas-data-marketplace

variables:
  # Target-specific variables with defaults
  catalog_name:
    description: "The Unity Catalog name for the data marketplace"
    default: "astellas_marketplace"

  database_instance_name:
    description: "The Lakebase database instance name"
    default: "astellas-data-marketplace"

  app_name:
    description: "The name of the Databricks App"
    default: "astellas-data-marketplace"

  source_code_path:
    description: "Path to the app source code"
    default: "./src"

  workspace_path:
    description: "Workspace path for the application"
    default: "/Workspace/foundationx/apps"

  database_capacity:
    description: "Database instance capacity (CU_1, CU_2, CU_4, etc.)"
    default: "CU_1"

# Define the workspace resources
resources:
  # Database instance for Lakebase
  database_instances:
    marketplace_db:
      name: ${var.database_instance_name}
      capacity: ${var.database_capacity}

  # Database catalog for the marketplace
  database_catalogs:
    marketplace_catalog:
      name: ${var.catalog_name}
      database_instance_name: ${resources.database_instances.marketplace_db.name}
      database_name: "marketplace_app"
      create_database_if_not_exists: true

  # The main web application
  apps:
    marketplace_app:
      name: ${var.app_name}
      description: "Astellas Internal Data Marketplace - Discover, explore, and manage data products"

      # Point to the app source code directory
      source_code_path: ${var.source_code_path}

      # Define the database resources this app can access
      resources:
        - name: "marketplace-database"
          database:
            database_instance_name: ${resources.database_instances.marketplace_db.name}
            permission: "CAN_MANAGE"

      # App permissions - adjust based on your organization's needs
      permissions:
        - user_name: "admins"
          level: "CAN_MANAGE"
        - group_name: "data-engineers"
          level: "CAN_MANAGE"
        - group_name: "data-analysts"
          level: "CAN_USE"

# Target-specific configurations
targets:
  development:
    default: true
    mode: development
    workspace:
      host: "https://your-dev-workspace.cloud.databricks.com"
    variables:
      catalog_name: "dev_astellas_marketplace"
      database_instance_name: "dev-marketplace-db"
      app_name: "dev-astellas-data-marketplace"
      source_code_path: "./src"
      workspace_path: "/Workspace/foundationx/apps/dev"
      database_capacity: "CU_1"

  staging:
    mode: development
    workspace:
      host: "https://your-staging-workspace.cloud.databricks.com"
    variables:
      catalog_name: "staging_astellas_marketplace"
      database_instance_name: "staging-marketplace-db"
      app_name: "staging-astellas-data-marketplace"
      source_code_path: "/Workspace/foundationx/apps/staging/astellas-marketplace-react"
      workspace_path: "/Workspace/foundationx/apps/staging"
      database_capacity: "CU_2"

  production:
    mode: production
    workspace:
      host: "https://your-prod-workspace.cloud.databricks.com"
    variables:
      catalog_name: "astellas_marketplace"
      database_instance_name: "astellas-data-marketplace"
      app_name: "astellas-data-marketplace"
      source_code_path: "/Workspace/foundationx/apps/astellas-marketplace-react"
      workspace_path: "/Workspace/foundationx/apps"
      database_capacity: "CU_4"

# Sync patterns for deployment
sync:
  include:
    - "src/**"
    - "resources/**"
    - "README.md"
  exclude:
    - "frontend/node_modules/**"
    - "**/*.pyc"
    - ".git/**"
    - "*.log"
    - "*.tmp"
